<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#D4785C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MyBuilding">
    <link rel="manifest" href="manifest.json">
    <title>MyBuilding - ◊î◊ë◊ô◊™ ◊©◊ú◊ô</title>

    <!-- Load config (contains admin emails - gitignored) -->
    <script src="config.js"></script>

    <!-- Fonts: Rubik for Hebrew/English + Fraunces for display -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ============================================
           CSS CUSTOM PROPERTIES - DESIGN TOKENS
           ============================================ */
        :root {
            /* Warm Terracotta Palette */
            --color-primary: #D4785C;
            --color-primary-dark: #B8614A;
            --color-primary-light: #E8A18C;
            --color-secondary: #2D5A4A;
            --color-secondary-light: #3D7A64;

            /* Neutrals - Warm */
            --color-cream: #FFF9F5;
            --color-sand: #F5E6D8;
            --color-sand-dark: #E8D4C4;
            --color-text: #3D2E2A;
            --color-text-muted: #8B7355;
            --color-text-light: #B8A090;

            /* Status Colors */
            --color-success: #4A9D7C;
            --color-success-bg: #E8F5F0;
            --color-danger: #C75D5D;
            --color-danger-bg: #FCF0F0;
            --color-warning: #D4A85C;
            --color-warning-bg: #FDF8F0;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(61, 46, 42, 0.06);
            --shadow-md: 0 4px 16px rgba(61, 46, 42, 0.08);
            --shadow-lg: 0 8px 32px rgba(61, 46, 42, 0.12);
            --shadow-glow: 0 0 40px rgba(212, 120, 92, 0.2);

            /* Typography */
            --font-display: 'Fraunces', serif;
            --font-body: 'Rubik', sans-serif;

            /* Safe Areas */
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);

            /* Animation */
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* ============================================
           RESET & BASE STYLES
           ============================================ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-cream);
            color: var(--color-text);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            line-height: 1.5;
        }

        /* RTL-aware text alignment */
        [dir="rtl"] {
            text-align: right;
        }

        [dir="ltr"] {
            text-align: left;
        }

        /* ============================================
           APP SHELL
           ============================================ */
        #root {
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        .app-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 430px;
            margin: 0 auto;
            width: 100%;
            background: var(--color-cream);
            position: relative;
        }

        /* ============================================
           MAIN CONTENT AREA
           ============================================ */
        .main-content {
            flex: 1;
            padding: var(--space-lg);
            padding-top: calc(var(--safe-top) + var(--space-lg));
            padding-bottom: calc(80px + var(--safe-bottom) + var(--space-lg));
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* ============================================
           WELCOME HEADER
           ============================================ */
        .welcome-header {
            margin-bottom: var(--space-xl);
            animation: slideDown 0.8s var(--ease-out-expo) forwards;
            opacity: 0;
            transform: translateY(-20px);
        }

        @keyframes slideDown {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .greeting-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .greeting {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--color-text);
            line-height: 1.2;
        }

        .greeting-emoji {
            font-size: 1.5rem;
            display: inline-block;
            animation: wave 2s ease-in-out infinite;
            transform-origin: 70% 70%;
        }

        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            10%, 30% { transform: rotate(14deg); }
            20% { transform: rotate(-8deg); }
            40% { transform: rotate(-4deg); }
            50%, 100% { transform: rotate(0deg); }
        }

        .language-toggle {
            background: var(--color-sand);
            border: none;
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-full);
            font-family: var(--font-body);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--color-text-muted);
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .language-toggle:hover {
            background: var(--color-sand-dark);
            color: var(--color-text);
        }

        .language-toggle:active {
            transform: scale(0.95);
        }

        .apartment-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .apartment-badge {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: white;
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: var(--shadow-md), var(--shadow-glow);
        }

        .building-name {
            color: var(--color-text-muted);
            font-size: 0.875rem;
        }

        /* ============================================
           PAYMENT STATUS CARD
           ============================================ */
        .payment-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.8s var(--ease-out-expo) 0.1s forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .payment-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at top right, var(--color-sand) 0%, transparent 70%);
            pointer-events: none;
        }

        .payment-card.paid {
            border-right: 4px solid var(--color-success);
        }

        .payment-card.debt {
            border-right: 4px solid var(--color-danger);
        }

        [dir="ltr"] .payment-card.paid,
        [dir="ltr"] .payment-card.debt {
            border-right: none;
            border-left: 4px solid var(--color-success);
        }

        [dir="ltr"] .payment-card.debt {
            border-left-color: var(--color-danger);
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .payment-label {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            font-weight: 500;
        }

        .payment-year {
            font-size: 0.75rem;
            color: var(--color-text-light);
            background: var(--color-sand);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
        }

        .payment-status-row {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .status-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .status-icon.paid {
            background: var(--color-success-bg);
        }

        .status-icon.debt {
            background: var(--color-danger-bg);
        }

        .status-details {
            flex: 1;
        }

        .status-text {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .status-text.paid {
            color: var(--color-success);
        }

        .status-text.debt {
            color: var(--color-danger);
        }

        .payment-amount {
            font-size: 0.875rem;
            color: var(--color-text-muted);
        }

        .payment-amount strong {
            color: var(--color-text);
            font-weight: 600;
        }

        .payment-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            color: var(--color-primary);
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s var(--ease-out-expo);
        }

        .payment-link:hover {
            color: var(--color-primary-dark);
            gap: var(--space-sm);
        }

        .payment-link svg {
            width: 16px;
            height: 16px;
            transition: transform 0.3s var(--ease-out-expo);
        }

        [dir="rtl"] .payment-link svg {
            transform: rotate(180deg);
        }

        .payment-link:hover svg {
            transform: translateX(4px);
        }

        [dir="rtl"] .payment-link:hover svg {
            transform: rotate(180deg) translateX(4px);
        }

        /* ============================================
           QUICK ACTIONS
           ============================================ */
        .quick-actions {
            margin-bottom: var(--space-xl);
            animation: slideUp 0.8s var(--ease-out-expo) 0.2s forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--color-text);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .action-button {
            background: white;
            border: none;
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s var(--ease-out-expo);
            position: relative;
            overflow: hidden;
        }

        .action-button::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(212, 120, 92, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-button:hover::before {
            opacity: 1;
        }

        .action-button:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .action-button:active {
            transform: translateY(-2px) scale(0.98);
        }

        .action-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: transform 0.3s var(--ease-out-back);
        }

        .action-button:hover .action-icon {
            transform: scale(1.1);
        }

        .action-icon.fault {
            background: linear-gradient(135deg, var(--color-warning-bg) 0%, #FDF0E0 100%);
        }

        .action-icon.emergency {
            background: linear-gradient(135deg, var(--color-danger-bg) 0%, #FCE8E8 100%);
        }

        .action-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text);
        }

        .action-sublabel {
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }

        /* ============================================
           RECENT NOTICES
           ============================================ */
        .notices-section {
            animation: slideUp 0.8s var(--ease-out-expo) 0.3s forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        .notices-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .see-all-link {
            color: var(--color-primary);
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all 0.3s var(--ease-out-expo);
        }

        .see-all-link:hover {
            color: var(--color-primary-dark);
        }

        .notices-scroll {
            display: flex;
            gap: var(--space-md);
            overflow-x: auto;
            padding-bottom: var(--space-sm);
            margin: 0 calc(var(--space-lg) * -1);
            padding-left: var(--space-lg);
            padding-right: var(--space-lg);
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .notices-scroll::-webkit-scrollbar {
            display: none;
        }

        .notice-card {
            flex-shrink: 0;
            width: 260px;
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-md);
            box-shadow: var(--shadow-sm);
            scroll-snap-align: start;
            transition: all 0.3s var(--ease-out-expo);
            cursor: pointer;
            position: relative;
        }

        .notice-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .notice-card.unread::after {
            content: '';
            position: absolute;
            top: var(--space-md);
            left: var(--space-md);
            width: 8px;
            height: 8px;
            background: var(--color-primary);
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(212, 120, 92, 0.2);
        }

        [dir="ltr"] .notice-card.unread::after {
            left: auto;
            right: var(--space-md);
        }

        .notice-date {
            font-size: 0.75rem;
            color: var(--color-text-light);
            margin-bottom: var(--space-xs);
        }

        .notice-title {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--color-text);
            margin-bottom: var(--space-xs);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .notice-preview {
            font-size: 0.8125rem;
            color: var(--color-text-muted);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .notice-type {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            margin-top: var(--space-sm);
        }

        .notice-type.urgent {
            background: var(--color-danger-bg);
            color: var(--color-danger);
        }

        .notice-type.event {
            background: var(--color-success-bg);
            color: var(--color-success);
        }

        .notice-type.info {
            background: var(--color-sand);
            color: var(--color-text-muted);
        }

        /* ============================================
           BOTTOM NAVIGATION
           ============================================ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: white;
            border-top: 1px solid var(--color-sand);
            padding: var(--space-sm) var(--space-md);
            padding-bottom: calc(var(--safe-bottom) + var(--space-sm));
            display: flex;
            justify-content: space-around;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(61, 46, 42, 0.06);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
            position: relative;
            text-decoration: none;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 24px;
            height: 3px;
            background: var(--color-primary);
            border-radius: var(--radius-full);
            transition: transform 0.3s var(--ease-out-expo);
        }

        .nav-item.active::before {
            transform: translateX(-50%) scaleX(1);
        }

        .nav-icon {
            font-size: 1.25rem;
            transition: all 0.3s var(--ease-out-expo);
        }

        .nav-item:hover .nav-icon {
            transform: translateY(-2px);
        }

        .nav-label {
            font-size: 0.6875rem;
            font-weight: 500;
            color: var(--color-text-light);
            transition: color 0.3s ease;
        }

        .nav-item.active .nav-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        .nav-badge {
            position: absolute;
            top: 4px;
            right: 12px;
            width: 8px;
            height: 8px;
            background: var(--color-danger);
            border-radius: 50%;
            border: 2px solid white;
        }

        /* ============================================
           DECORATIVE ELEMENTS
           ============================================ */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 300px;
            background:
                radial-gradient(ellipse at 30% 0%, rgba(212, 120, 92, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 20%, rgba(45, 90, 74, 0.05) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        .main-content {
            position: relative;
            z-index: 1;
        }

        /* ============================================
           LOADING STATE
           ============================================ */
        .skeleton {
            background: linear-gradient(90deg, var(--color-sand) 25%, var(--color-sand-dark) 50%, var(--color-sand) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ============================================
           RESPONSIVE ADJUSTMENTS
           ============================================ */
        @media (max-width: 360px) {
            :root {
                --space-lg: 20px;
            }

            .greeting {
                font-size: 1.5rem;
            }

            .notice-card {
                width: 220px;
            }
        }

        @media (min-width: 768px) {
            .app-container {
                border-radius: var(--radius-xl);
                margin-top: var(--space-xl);
                margin-bottom: var(--space-xl);
                box-shadow: var(--shadow-lg);
                min-height: calc(100vh - var(--space-xl) * 2);
            }

            .bottom-nav {
                border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            }
        }

        /* ============================================
           PRINT STYLES
           ============================================ */
        @media print {
            .bottom-nav,
            .bg-pattern {
                display: none;
            }

            .main-content {
                padding-bottom: var(--space-lg);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React + ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Supabase Client (for authentication) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="src/supabase.js"></script>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // ============================================
        // TRANSLATIONS
        // ============================================
        const translations = {
            he: {
                greeting: {
                    morning: '◊ë◊ï◊ß◊® ◊ò◊ï◊ë',
                    afternoon: '◊¶◊î◊®◊ô◊ô◊ù ◊ò◊ï◊ë◊ô◊ù',
                    evening: '◊¢◊®◊ë ◊ò◊ï◊ë',
                    night: '◊ú◊ô◊ú◊î ◊ò◊ï◊ë'
                },
                apartment: '◊ì◊ô◊®◊î',
                building: '◊û◊í◊ì◊ú◊ô ◊î◊ô◊ù',
                payment: {
                    title: '◊°◊ò◊ò◊ï◊° ◊™◊©◊ú◊ï◊ù',
                    year: '2025',
                    paid: '◊©◊ï◊ú◊ù ◊ë◊û◊ú◊ï◊ê◊ï',
                    debt: '◊ô◊™◊®◊™ ◊ó◊ï◊ë',
                    total: '◊°◊î◊¥◊õ ◊©◊ï◊ú◊ù',
                    remaining: '◊†◊ï◊™◊® ◊ú◊™◊©◊ú◊ï◊ù',
                    history: '◊î◊ô◊°◊ò◊ï◊®◊ô◊ô◊™ ◊™◊©◊ú◊ï◊û◊ô◊ù'
                },
                actions: {
                    title: '◊§◊¢◊ï◊ú◊ï◊™ ◊û◊î◊ô◊®◊ï◊™',
                    report: '◊ì◊ï◊ï◊ó ◊¢◊ú ◊™◊ß◊ú◊î',
                    reportSub: '◊†◊ñ◊ô◊ú◊î, ◊™◊ê◊ï◊®◊î, ◊û◊¢◊ú◊ô◊™...',
                    emergency: '◊ó◊ô◊®◊ï◊ù',
                    emergencySub: '◊ß◊ï◊ï◊ô◊ù ◊ó◊û◊ô◊ù',
                    emergencyConfirm: '◊ú◊î◊™◊ß◊©◊® ◊ú◊ß◊ï ◊î◊ó◊ô◊®◊ï◊ù?'
                },
                notices: {
                    title: '◊î◊ï◊ì◊¢◊ï◊™ ◊ê◊ó◊®◊ï◊†◊ï◊™',
                    seeAll: '◊õ◊ú ◊î◊î◊ï◊ì◊¢◊ï◊™',
                    urgent: '◊ì◊ó◊ï◊£',
                    event: '◊ê◊ô◊®◊ï◊¢',
                    info: '◊û◊ô◊ì◊¢',
                    empty: '◊ê◊ô◊ü ◊î◊ï◊ì◊¢◊ï◊™ ◊ó◊ì◊©◊ï◊™'
                },
                nav: {
                    home: '◊ë◊ô◊™',
                    faults: '◊™◊ß◊ú◊ï◊™',
                    notices: '◊î◊ï◊ì◊¢◊ï◊™',
                    community: '◊ß◊î◊ô◊ú◊î',
                    profile: '◊§◊®◊ï◊§◊ô◊ú'
                }
            },
            en: {
                greeting: {
                    morning: 'Good morning',
                    afternoon: 'Good afternoon',
                    evening: 'Good evening',
                    night: 'Good night'
                },
                apartment: 'Apt',
                building: 'Sea Towers',
                payment: {
                    title: 'Payment Status',
                    year: '2025',
                    paid: 'Fully Paid',
                    debt: 'Outstanding Balance',
                    total: 'Total Paid',
                    remaining: 'Remaining',
                    history: 'Payment History'
                },
                actions: {
                    title: 'Quick Actions',
                    report: 'Report Issue',
                    reportSub: 'Leak, lighting, elevator...',
                    emergency: 'Emergency',
                    emergencySub: 'Hotlines',
                    emergencyConfirm: 'Call emergency hotline?'
                },
                notices: {
                    title: 'Recent Notices',
                    seeAll: 'See All',
                    urgent: 'Urgent',
                    event: 'Event',
                    info: 'Info',
                    empty: 'No new notices'
                },
                nav: {
                    home: 'Home',
                    faults: 'Issues',
                    notices: 'Notices',
                    community: 'Community',
                    profile: 'Profile'
                }
            }
        };

        // ============================================
        // LANGUAGE CONTEXT
        // ============================================
        const LanguageContext = createContext();

        const LanguageProvider = ({ children }) => {
            const [lang, setLang] = useState('he');
            const t = translations[lang];
            const isRTL = lang === 'he';

            useEffect(() => {
                document.documentElement.lang = lang;
                document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
            }, [lang, isRTL]);

            const toggleLanguage = () => {
                setLang(prev => prev === 'he' ? 'en' : 'he');
            };

            return (
                <LanguageContext.Provider value={{ lang, t, isRTL, toggleLanguage }}>
                    {children}
                </LanguageContext.Provider>
            );
        };

        const useLanguage = () => useContext(LanguageContext);

        // ============================================
        // CONFIG HELPER
        // ============================================
        const getConfig = () => {
            return window.APP_CONFIG || {
                ADMIN_EMAIL: '',
                ADMIN_EMAILS: [],
                BUILDING_NAME: '◊î◊ë◊†◊ô◊ô◊ü ◊©◊ú◊ô',
                BUILDING_NAME_EN: 'My Building'
            };
        };

        const isAdmin = (email) => {
            const config = getConfig();
            return email === config.ADMIN_EMAIL || (config.ADMIN_EMAILS || []).includes(email);
        };

        // ============================================
        // USER DATA - Will be populated from database
        // ============================================
        const mockUser = {
            name: { he: '', en: '' },
            email: '',
            apartmentNumber: '',
            buildingName: {
                he: getConfig().BUILDING_NAME,
                en: getConfig().BUILDING_NAME_EN
            }
        };

        const mockPayment = {
            year: 2025,
            isPaid: false,
            amount: 0,
            paidAmount: 0
        };

        // Empty notices - will be populated from database
        const mockNotices = [];

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        const getGreeting = (translations) => {
            const hour = new Date().getHours();
            if (hour >= 5 && hour < 12) return translations.morning;
            if (hour >= 12 && hour < 17) return translations.afternoon;
            if (hour >= 17 && hour < 21) return translations.evening;
            return translations.night;
        };

        const formatDate = (dateStr, lang) => {
            const date = new Date(dateStr);
            return date.toLocaleDateString(lang === 'he' ? 'he-IL' : 'en-US', {
                day: 'numeric',
                month: 'short'
            });
        };

        const formatCurrency = (amount, lang) => {
            return new Intl.NumberFormat(lang === 'he' ? 'he-IL' : 'en-US', {
                style: 'currency',
                currency: 'ILS',
                minimumFractionDigits: 0
            }).format(amount);
        };

        // ============================================
        // SVG ICONS
        // ============================================
        const Icons = {
            Check: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            ),
            AlertCircle: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            ),
            ArrowRight: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
            ),
            Home: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            ),
            Tool: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
            ),
            Bell: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
            ),
            User: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            ),
            Phone: () => (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
            )
        };

        // ============================================
        // COMPONENTS
        // ============================================

        // Welcome Header
        const WelcomeHeader = () => {
            const { t, lang, toggleLanguage } = useLanguage();
            const greeting = getGreeting(t.greeting);
            const userName = mockUser.name[lang];

            return (
                <header className="welcome-header">
                    <div className="greeting-row">
                        <h1 className="greeting">
                            {greeting}, {userName} <span className="greeting-emoji">üëã</span>
                        </h1>
                        <button className="language-toggle" onClick={toggleLanguage}>
                            {lang === 'he' ? 'EN' : '◊¢◊ë'}
                        </button>
                    </div>
                    <div className="apartment-info">
                        <span className="apartment-badge">
                            {t.apartment} {mockUser.apartmentNumber}
                        </span>
                        <span className="building-name">{mockUser.buildingName[lang]}</span>
                    </div>
                </header>
            );
        };

        // Payment Status Card
        const PaymentCard = () => {
            const { t, lang } = useLanguage();
            const { isPaid, amount, paidAmount } = mockPayment;

            return (
                <div className={`payment-card ${isPaid ? 'paid' : 'debt'}`}>
                    <div className="payment-header">
                        <span className="payment-label">{t.payment.title}</span>
                        <span className="payment-year">{t.payment.year}</span>
                    </div>

                    <div className="payment-status-row">
                        <div className={`status-icon ${isPaid ? 'paid' : 'debt'}`}>
                            {isPaid ? '‚úì' : '!'}
                        </div>
                        <div className="status-details">
                            <div className={`status-text ${isPaid ? 'paid' : 'debt'}`}>
                                {isPaid ? t.payment.paid : t.payment.debt}
                            </div>
                            <div className="payment-amount">
                                {isPaid ? t.payment.total : t.payment.remaining}: <strong>{formatCurrency(isPaid ? paidAmount : amount - paidAmount, lang)}</strong>
                            </div>
                        </div>
                    </div>

                    <a href="#" className="payment-link">
                        {t.payment.history}
                        <Icons.ArrowRight />
                    </a>
                </div>
            );
        };

        // Quick Actions
        const QuickActions = () => {
            const { t } = useLanguage();

            const handleReportFault = () => {
                window.location.href = 'faults.html?action=new';
            };

            const handleEmergency = () => {
                // Show emergency contacts modal or call
                const emergencyNumber = '102'; // Building security or emergency
                if (confirm(t.actions.emergencyConfirm || '◊î◊™◊ß◊©◊® ◊ú◊ó◊ô◊®◊ï◊ù?')) {
                    window.location.href = `tel:${emergencyNumber}`;
                }
            };

            return (
                <section className="quick-actions">
                    <h2 className="section-title">{t.actions.title}</h2>
                    <div className="actions-grid">
                        <button className="action-button" onClick={handleReportFault}>
                            <div className="action-icon fault">üîß</div>
                            <span className="action-label">{t.actions.report}</span>
                            <span className="action-sublabel">{t.actions.reportSub}</span>
                        </button>
                        <button className="action-button" onClick={handleEmergency}>
                            <div className="action-icon emergency">üö®</div>
                            <span className="action-label">{t.actions.emergency}</span>
                            <span className="action-sublabel">{t.actions.emergencySub}</span>
                        </button>
                    </div>
                </section>
            );
        };

        // Notice Card
        const NoticeCard = ({ notice }) => {
            const { t, lang } = useLanguage();

            return (
                <article className={`notice-card ${!notice.isRead ? 'unread' : ''}`}>
                    <time className="notice-date">{formatDate(notice.date, lang)}</time>
                    <h3 className="notice-title">{notice.title[lang]}</h3>
                    <p className="notice-preview">{notice.preview[lang]}</p>
                    <span className={`notice-type ${notice.type}`}>
                        {t.notices[notice.type]}
                    </span>
                </article>
            );
        };

        // Recent Notices Section
        const RecentNotices = () => {
            const { t } = useLanguage();

            return (
                <section className="notices-section">
                    <div className="notices-header">
                        <h2 className="section-title">{t.notices.title}</h2>
                        <a href="notices.html" className="see-all-link">
                            {t.notices.seeAll}
                            <Icons.ArrowRight />
                        </a>
                    </div>
                    {mockNotices.length === 0 ? (
                        <div style={{ textAlign: 'center', padding: 'var(--space-xl)', color: 'var(--color-text-muted)' }}>
                            <div style={{ fontSize: '2rem', marginBottom: 'var(--space-sm)' }}>üì≠</div>
                            <div>{t.notices.empty}</div>
                        </div>
                    ) : (
                        <div className="notices-scroll">
                            {mockNotices.map(notice => (
                                <NoticeCard key={notice.id} notice={notice} />
                            ))}
                        </div>
                    )}
                </section>
            );
        };

        // Bottom Navigation
        const BottomNav = () => {
            const { t } = useLanguage();

            const navItems = [
                { id: 'home', icon: 'üè†', label: t.nav.home, href: 'index.html', active: true },
                { id: 'faults', icon: 'üîß', label: t.nav.faults, href: 'faults.html' },
                { id: 'notices', icon: 'üîî', label: t.nav.notices, href: 'notices.html', badge: true },
                { id: 'community', icon: 'üë•', label: t.nav.community, href: 'community.html' },
                { id: 'profile', icon: 'üë§', label: t.nav.profile, href: 'profile.html' }
            ];

            return (
                <nav className="bottom-nav">
                    {navItems.map(item => (
                        <a
                            key={item.id}
                            href={item.href}
                            className={`nav-item ${item.active ? 'active' : ''}`}
                        >
                            <span className="nav-icon">{item.icon}</span>
                            <span className="nav-label">{item.label}</span>
                            {item.badge && !item.active && <span className="nav-badge" />}
                        </a>
                    ))}
                </nav>
            );
        };

        // Waiting for Approval Screen
        const WaitingForApproval = () => {
            const { t, lang } = useLanguage();
            const config = window.APP_CONFIG || {};
            const buildingName = lang === 'he' ? config.BUILDING_NAME : config.BUILDING_NAME_EN;

            const texts = {
                he: {
                    title: '◊û◊û◊™◊ô◊ü ◊ú◊ê◊ô◊©◊ï◊®',
                    message: '◊î◊ë◊ß◊©◊î ◊©◊ú◊ö ◊ú◊î◊¶◊ò◊®◊£ ◊ú◊ë◊†◊ô◊ô◊ü ◊†◊û◊¶◊ê◊™ ◊ë◊ë◊ì◊ô◊ß◊î.',
                    info: '◊ï◊¢◊ì ◊î◊ë◊ô◊™ ◊ô◊ë◊ì◊ï◊ß ◊ê◊™ ◊î◊§◊®◊ò◊ô◊ù ◊©◊ú◊ö ◊ï◊ô◊ê◊©◊® ◊ê◊™ ◊î◊í◊ô◊©◊î ◊ë◊î◊ß◊ì◊ù.',
                    contact: '◊ú◊©◊ê◊ú◊ï◊™ ◊†◊ô◊™◊ü ◊ú◊§◊†◊ï◊™ ◊ú◊ï◊ï◊¢◊ì ◊î◊ë◊ô◊™',
                    logout: '◊î◊™◊†◊™◊ß'
                },
                en: {
                    title: 'Waiting for Approval',
                    message: 'Your request to join the building is being reviewed.',
                    info: 'The building committee will verify your details and approve access soon.',
                    contact: 'For questions, please contact the building committee',
                    logout: 'Logout'
                }
            };
            const txt = texts[lang];

            const handleLogout = async () => {
                if (window.AppAuth) {
                    await window.AppAuth.signOut();
                }
                window.location.href = 'auth.html';
            };

            return (
                <div className="app-container" style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '100vh', padding: 'var(--space-lg)', textAlign: 'center' }}>
                    <div style={{ fontSize: '4rem', marginBottom: 'var(--space-lg)' }}>‚è≥</div>
                    <h1 style={{ fontFamily: 'var(--font-display)', fontSize: '1.5rem', marginBottom: 'var(--space-md)', color: 'var(--color-secondary)' }}>
                        {txt.title}
                    </h1>
                    <p style={{ fontSize: '1rem', color: 'var(--color-text)', marginBottom: 'var(--space-sm)', maxWidth: '300px' }}>
                        {txt.message}
                    </p>
                    <p style={{ fontSize: '0.875rem', color: 'var(--color-text-muted)', marginBottom: 'var(--space-lg)', maxWidth: '300px' }}>
                        {txt.info}
                    </p>
                    <div style={{ background: 'var(--color-sand)', padding: 'var(--space-md)', borderRadius: 'var(--radius-md)', marginBottom: 'var(--space-lg)' }}>
                        <div style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)', marginBottom: 'var(--space-xs)' }}>
                            {txt.contact}
                        </div>
                        <div style={{ fontWeight: 600 }}>üè¢ {buildingName}</div>
                    </div>
                    <button
                        onClick={handleLogout}
                        style={{
                            background: 'var(--color-cream)',
                            border: '2px solid var(--color-sand-dark)',
                            borderRadius: 'var(--radius-md)',
                            padding: 'var(--space-sm) var(--space-lg)',
                            fontFamily: 'var(--font-body)',
                            fontSize: '0.875rem',
                            color: 'var(--color-text-muted)',
                            cursor: 'pointer'
                        }}
                    >
                        {txt.logout}
                    </button>
                </div>
            );
        };

        // Auth Guard - checks if user is approved
        const AuthGuard = ({ children }) => {
            const [authState, setAuthState] = useState('loading'); // 'loading' | 'approved' | 'pending' | 'unauthenticated'
            const [user, setUser] = useState(null);

            useEffect(() => {
                const checkAuth = async () => {
                    // If Supabase is not configured, show app without auth
                    if (!window.supabaseClient) {
                        setAuthState('approved');
                        return;
                    }

                    try {
                        const currentUser = await window.AppAuth.getCurrentUser();
                        if (!currentUser) {
                            setAuthState('unauthenticated');
                            return;
                        }

                        setUser(currentUser);
                        const profile = await window.AppAuth.getUserProfile(currentUser.id);

                        if (profile?.is_approved) {
                            setAuthState('approved');
                        } else {
                            setAuthState('pending');
                        }
                    } catch (error) {
                        console.error('Auth check error:', error);
                        setAuthState('approved'); // Fallback to show app
                    }
                };

                checkAuth();

                // Listen for auth changes
                if (window.AppAuth) {
                    const unsubscribe = window.AppAuth.onAuthStateChange((event, session) => {
                        if (event === 'SIGNED_OUT') {
                            setAuthState('unauthenticated');
                        } else if (event === 'SIGNED_IN' && session?.user) {
                            checkAuth();
                        }
                    });
                    return unsubscribe;
                }
            }, []);

            if (authState === 'loading') {
                return (
                    <div className="app-container" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh' }}>
                        <div style={{ textAlign: 'center' }}>
                            <div style={{ fontSize: '2rem', marginBottom: 'var(--space-md)' }}>üè†</div>
                            <div style={{ color: 'var(--color-text-muted)' }}>◊ò◊ï◊¢◊ü...</div>
                        </div>
                    </div>
                );
            }

            if (authState === 'unauthenticated') {
                window.location.href = 'auth.html';
                return null;
            }

            if (authState === 'pending') {
                return <WaitingForApproval />;
            }

            return children;
        };

        // Main App Content
        const AppContent = () => {
            return (
                <div className="app-container">
                    <div className="bg-pattern" />
                    <main className="main-content">
                        <WelcomeHeader />
                        <PaymentCard />
                        <QuickActions />
                        <RecentNotices />
                    </main>
                    <BottomNav />
                </div>
            );
        };

        // Main App with Auth
        const App = () => {
            return (
                <LanguageProvider>
                    <AuthGuard>
                        <AppContent />
                    </AuthGuard>
                </LanguageProvider>
            );
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
